jQuery((function(e){var t,s,a,__=wp.i18n.__,_n=wp.i18n._n,i=wp.i18n.sprintf,n=new ClipboardJS(".site-health-copy-buttons .copy-button"),o=e(".health-check-body.health-check-status-tab").length,r=e(".health-check-body.health-check-debug-tab").length,l=e("#health-check-accordion-block-wp-paths-sizes"),c=e("#adminmenu .site-health-counter"),h=e("#adminmenu .site-health-counter .count");function u(t){var s,a,n=wp.template("health-check-issue"),o=e("#health-check-issues-"+t.status);if(!function(e){var t,s,a,i,n={test:"string",label:"string",description:"string"},o=!0;if("object"!=typeof e)return!1;for(t in n)if("object"==typeof(s=n[t]))for(a in s)i=s[a],void 0!==e[t]&&void 0!==e[t][a]&&i===typeof e[t][a]||(o=!1);else void 0!==e[t]&&s===typeof e[t]||(o=!1);return o}(t))return!1;SiteHealth.site_status.issues[t.status]++,a=SiteHealth.site_status.issues[t.status],void 0===t.test&&(t.test=t.status+a),"critical"===t.status?s=i(_n("%s critical issue","%s critical issues",a),'<span class="issue-count">'+a+"</span>"):"recommended"===t.status?s=i(_n("%s recommended improvement","%s recommended improvements",a),'<span class="issue-count">'+a+"</span>"):"good"===t.status&&(s=i(_n("%s item with no issues detected","%s items with no issues detected",a),'<span class="issue-count">'+a+"</span>")),s&&e(".site-health-issue-count-title",o).html(s),h.text(SiteHealth.site_status.issues.critical),0<parseInt(SiteHealth.site_status.issues.critical,0)?(e("#health-check-issues-critical").removeClass("hidden"),c.removeClass("count-0")):c.addClass("count-0"),0<parseInt(SiteHealth.site_status.issues.recommended,0)&&e("#health-check-issues-recommended").removeClass("hidden"),e(".issues","#health-check-issues-"+t.status).append(n(t))}function d(){var t,s,a=e(".site-health-progress"),i=a.closest(".site-health-progress-wrapper"),n=e(".site-health-progress-label",i),r=e(".site-health-progress svg #bar"),l=parseInt(SiteHealth.site_status.issues.good,0)+parseInt(SiteHealth.site_status.issues.recommended,0)+1.5*parseInt(SiteHealth.site_status.issues.critical,0),c=.5*parseInt(SiteHealth.site_status.issues.recommended,0)+1.5*parseInt(SiteHealth.site_status.issues.critical,0),h=100-Math.ceil(c/l*100);0!==l?(i.removeClass("loading"),t=r.attr("r"),0>h&&(h=0),100<h&&(h=100),s=(100-h)/100*(Math.PI*(2*t))+"px",r.css({strokeDashoffset:s}),80<=h&&0===parseInt(SiteHealth.site_status.issues.critical,0)?(i.addClass("green").removeClass("orange"),n.text(__("Good")),m("good")):(i.addClass("orange").removeClass("green"),n.text(__("Should be improved")),m("improvable")),o&&(e.post(ajaxurl,{action:"health-check-site-status-result",_wpnonce:SiteHealth.nonce.site_status_result,counts:SiteHealth.site_status.issues}),100===h&&(e(".site-status-all-clear").removeClass("hide"),e(".site-status-has-issues").addClass("hide")))):a.addClass("hidden")}function p(e,t){var s;s={status:"recommended",label:__("A test is unavailable"),badge:{color:"red",label:__("Unavailable")},description:"<p>"+e+"</p><p>"+t+"</p>",actions:""},u(wp.hooks.applyFilters("site_status_test_result",s))}function m(e){if("site-health"===SiteHealth.screen)switch(e){case"good":wp.a11y.speak(__("All site health tests have finished running. Your site is looking good."));break;case"improvable":wp.a11y.speak(__("All site health tests have finished running. There are items that should be addressed."));break;case"waiting-for-directory-sizes":wp.a11y.speak(__("Running additional tests... please wait."));break;default:return}}n.on("success",(function(s){var a=e(s.trigger),i=e(".success",a.closest("div"));s.clearSelection(),clearTimeout(t),i.removeClass("hidden"),t=setTimeout((function(){i.addClass("hidden")}),3e3),wp.a11y.speak(__("Site information has been copied to your clipboard."))})),e(".health-check-accordion").on("click",".health-check-accordion-trigger",(function(){"true"===e(this).attr("aria-expanded")?(e(this).attr("aria-expanded","false"),e("#"+e(this).attr("aria-controls")).attr("hidden",!0)):(e(this).attr("aria-expanded","true"),e("#"+e(this).attr("aria-controls")).attr("hidden",!1))})),e(".site-health-view-passed").on("click",(function(){var t=e("#health-check-issues-good");t.toggleClass("hidden"),e(this).attr("aria-expanded",!t.hasClass("hidden"))})),"undefined"!=typeof SiteHealth&&(0===SiteHealth.site_status.direct.length&&0===SiteHealth.site_status.async.length?d():SiteHealth.site_status.issues={good:0,recommended:0,critical:0},0<SiteHealth.site_status.direct.length&&e.each(SiteHealth.site_status.direct,(function(){u(this)})),0<SiteHealth.site_status.async.length?function t(){var s=!0;1<=SiteHealth.site_status.async.length&&e.each(SiteHealth.site_status.async,(function(){var a={action:"health-check-"+this.test.replace("_","-"),_wpnonce:SiteHealth.nonce.site_status};return!!this.completed||(s=!1,this.completed=!0,void 0!==this.has_rest&&this.has_rest?wp.apiRequest({url:wp.url.addQueryArgs(this.test,{_locale:"user"}),headers:this.headers}).done((function(e){u(wp.hooks.applyFilters("site_status_test_result",e))})).fail((function(e){var t;t=void 0!==e.responseJSON&&void 0!==e.responseJSON.message?e.responseJSON.message:__("No details available"),p(this.url,t)})).always((function(){t()})):e.post(ajaxurl,a).done((function(e){u(wp.hooks.applyFilters("site_status_test_result",e.data))})).fail((function(e){var t;t=void 0!==e.responseJSON&&void 0!==e.responseJSON.message?e.responseJSON.message:__("No details available"),p(this.url,t)})).always((function(){t()})),!1)})),s&&d()}():d()),r&&(l.length?(s=(new Date).getTime(),a=window.setTimeout((function(){m("waiting-for-directory-sizes")}),3e3),wp.apiRequest({path:"/wp-site-health/v1/directory-sizes"}).done((function(t){var s,a,i;s=t||{},a=e("button.button.copy-button"),i=a.attr("data-clipboard-text"),e.each(s,(function(e,t){var s=t.debug||t.size;void 0!==s&&(i=i.replace(e+": loading...",e+": "+s))})),a.attr("data-clipboard-text",i),l.find("td[class]").each((function(t,a){var i=e(a),n=i.attr("class");s.hasOwnProperty(n)&&s[n].size&&i.text(s[n].size)}))})).always((function(){var t=(new Date).getTime()-s;e(".health-check-wp-paths-sizes.spinner").css("visibility","hidden"),t>3e3?(t=t>6e3?0:6500-t,window.setTimeout((function(){d()}),t)):window.clearTimeout(a),e(document).trigger("site-health-info-dirsizes-done")}))):d()),e(".health-check-offscreen-nav-wrapper").on("click",(function(){e(this).toggleClass("visible")}))}));